<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>VitaTrack</title>
    <link rel="icon" type="image/png" sizes="192x192" href="assets/img/logo-icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/img/logo-icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/img/logo-icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/img/logo-icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/img/logo-icon-512.png">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="assets/css/styles.css">
<link rel="apple-touch-icon" sizes="180x180" href="assets/img/logo-icon-512.png">
<script type="text/javascript">
	if('serviceWorker' in navigator){
		navigator.serviceWorker.register('service_worker.js');
	}
</script>
</head>

<body>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-auth.js"></script>
    <script type="text/javascript">
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBeoZwZGa6f1aHzLIrUU66MgQlvrssLAkA",
  authDomain: "vitatrack-75bda.firebaseapp.com",
  projectId: "vitatrack-75bda",
  storageBucket: "vitatrack-75bda.appspot.com",
  messagingSenderId: "252880004411",
  appId: "1:252880004411:web:671a716ffcb35a2e58431e",
  measurementId: "G-SZZ8S3SJDS" //used in firebase analytics
};

firebase.initializeApp(firebaseConfig);

function signInWithEmailPassword() {
  //var email = "test@example.com";
//  var password = "hunter2";
  var email = document.getElementById("emailField").value;
  var password = document.getElementById("passField").value;
  var dis = document.getElementById("loginErrorDiv");

  if (email == ""){
    //...change some div to no email entered
    //console.log("No email was entered");
    dis.innerHTML = "Please enter an email address";
    return;
  }
  if (password == ""){
    //...
    //console.log("No password was entered");
    dis.innerHTML = "Please enter a password";
    return;
  }

  // [START auth_signin_password]
  firebase.auth().signInWithEmailAndPassword(email, password)
    .then((userCredential) => {
      // Signed in
      var user = userCredential.user;
      console.log("Signed in");
      // ...
      window.location.assign("home.html"); //change this to actual web home page
    })
    .catch((error) => {
      var errorCode = error.code;
      var errorMessage = error.message;

      console.log("Error "+errorCode +": "+errorMessage);
      switch(errorCode){
        case "auth/user-not-found":
          //console.log("User not found"); //change this into showing error in div
          dis.innerHTML = "User not found";
          break;
        case "auth/user-disabled":
          //console.log("User has been disabled");
          dis.innerHTML = "User has been disabled";
          break;
        case "auth/invalid-email":
          //console.log("User has invalid Email");
          dis.innerHTML = "User has invalid Email";
          break;
        case "auth/wrong-password":
          //console.log("Email or password is incorrect");
          dis.innerHTML = "The password you entered is incorrect. <b><a onclick=\"forgotPassword()\">Forgotten Password?</a></b>";
          break;
        default:
          console.log(errorCode + ": " + errorMessage);
      }
    });
  // [END auth_signin_password]
}
function forgotPassword(){
  var emailAddress = document.getElementById("emailField").value;

  //should really take to some other screen instead where this can be completed

  firebase.auth().sendPasswordResetEmail(emailAddress).then(function() {
    var dis = document.getElementById("loginErrorDiv");
    dis.style.color = "blue";
    dis.innerHTML = "Email Sent";
  }).catch(function(error){
    console.log("error sending email");
  })
}

    </script>
    <nav class="navbar navbar-light navbar-expand-md text-center login-signup-navbar">
        <div class="container-fluid"><img id="logo-landscape" src="assets/img/logo-landscape-white.png" onclick="location.href=&#39;index&#39;;"><button data-toggle="collapse" class="navbar-toggler nav-toggler-login-signup" data-target="#navcol-1"><span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navcol-1">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"><button class="btn btn-primary" id="login-button" type="button" onclick="location.href=&#39;index&#39;;">Home</button></li>
                    <li class="nav-item"><button class="btn btn-primary" type="button" onclick="location.href=&#39;signup.html&#39;;">Signup</button></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="onboarding-bubble">
        <h1 class="login-heading">Login to VitaTrack</h1>
        <form class="login-form">
            <p class="onboarding-subheading">Email:</p><input class="form-control login-signup-fields" type="text" id="emailField">
            <p class="onboarding-subheading">Password:</p><input class="form-control login-signup-fields" type="password" id="passField">
            <div id="loginErrorDiv" class="login-error"></div><button class="btn btn-primary login-signup-button" id="loginForm" type="button" onclick="signInWithEmailPassword()">Login</button>
        </form>
    </div>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
</body>

</html>